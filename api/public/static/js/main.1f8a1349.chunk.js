(this.webpackJsonplabforward=this.webpackJsonplabforward||[]).push([[0],{38:function(t,e,s){t.exports=s(74)},43:function(t,e,s){},71:function(t,e){},74:function(t,e,s){"use strict";s.r(e);var a=s(1),i=s.n(a),n=s(8),r=s.n(n),o=(s(43),s(34)),c=s(9),h=s(10),l=s(35),d=s(32),u=s(36),m=s(33),f=s.n(m),p=s(0),g=["LINE","AREA"],v=function(){function t(){var e=this;Object(c.a)(this,t),this.elRef=null,this.margin={top:10,right:30,bottom:30,left:30},this.responsiveHeight=!1,this.responsiveWidth=!1,this.xScale=p.k(),this.yScale=p.j(),this.seriesDict={},this.toggleSeries=function(t){var s=t.target.id;if(s){var a=e.seriesDict[s],i=a.ref.classed("hidden");a.ref.classed("hidden",!i)}}}return Object(h.a)(t,[{key:"init",value:function(t){var e=t.elRef,s=t.width,a=t.height,i=t.classList;this.elRef=e,void 0===s&&(this.responsiveWidth=!0),void 0===a&&(this.responsiveHeight=!0),this.outerWidth=s||this.elRef.offsetWidth,this.outerHeight=a||this.elRef.offsetHeight,this.classList=i||{},this.draw()}},{key:"draw",value:function(){this.svg=p.l(this.elRef).append("svg").attr("width",this.outerWidth).attr("height",this.outerHeight).classed(this.classList.svg||null,!0),this.group=this.svg.append("g").attr("width",this.outerWidth-this.margin.left-this.margin.right).attr("height",this.outerHeight-this.margin.top-this.margin.bottom).attr("transform","translate(".concat(this.margin.left," , ").concat(this.margin.top,")")).classed(this.classList.group||null,!0),this.xScale.range([0,this.outerWidth-this.margin.left-this.margin.right]),this.xAxisRef=this.group.append("g").attr("transform","translate(0,".concat(this.outerHeight-this.margin.bottom,")")).classed("x-axis",!0),this.yScale.range([this.outerHeight-this.margin.bottom,0]),this.yAxisRef=this.group.append("g").attr("transform","translate(0, 0)").classed("y-axis",!0)}},{key:"addSeries",value:function(t){var e=t.name,s=t.type,a=t.fill,i=t.stroke,n=t.strokeWidth;t.id;if(this.seriesDict[e])throw new Error("Series name must be unique!");if(!g.includes(s))throw new Error("Series type not supported!");this.seriesDict[e]={type:s,ref:this.group.append("path").attr("fill",a||"none").attr("stroke",i||"black").attr("stroke-width",n||2).classed("series",!0).classed("hidden",!1)}}},{key:"setSeriesData",value:function(t,e){var s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(window.focused){var a=this.seriesDict[t];switch(this.adjustDimensions(),s&&this.adjustAxes(e),a.type){case"AREA":this.updateAreaSeries(a,e);break;case"LINE":default:this.updateLineSeries(a,e)}}}},{key:"updateLineSeries",value:function(t,e){var s=this;t.ref.datum(e).transition().duration(20).ease(p.e).attr("d",p.h().x((function(t){return s.xScale(t.timestamp)})).y((function(t){return s.yScale(t.value)})))}},{key:"updateAreaSeries",value:function(t,e){var s=this;t.ref.datum(e).transition().duration(20).ease(p.e).attr("d",p.a().x((function(t){return s.xScale(t.timestamp)})).y0(this.yScale(0)).y1((function(t){return s.yScale(t.value)})))}},{key:"adjustAxes",value:function(t){var e=p.i(t,(function(t){return t.value}));this.xScale.domain(p.f(t,(function(t){return t.timestamp}))),this.xAxisRef.transition().duration(20).ease(p.d).call(p.b(this.xScale)),this.yScale.domain([0,e]),this.yAxisRef.transition().duration(20).ease(p.d).call(p.c(this.yScale).ticks(e<6?e:6).tickFormat(p.g("d")))}},{key:"adjustDimensions",value:function(){this.responsiveHeight&&(this.outerHeight=this.elRef.offsetHeight,this.svg.transition().duration(20).ease(p.d).attr("height",this.outerHeight),this.group.transition().duration(20).ease(p.d).attr("height",this.outerHeight-this.margin.top-this.margin.bottom),this.yScale.range([this.outerHeight-this.margin.bottom,0])),this.responsiveWidth&&(this.outerWidth=this.elRef.offsetWidth,this.svg.transition().duration(20).ease(p.d).attr("width",this.outerWidth),this.group.transition().duration(20).ease(p.d).attr("width",this.outerWidth-this.margin.left-this.margin.right),this.xScale.range([0,this.outerWidth-this.margin.left-this.margin.right]))}}]),t}(),k=50,y=["reconnect_error","connect_error","connect_timeout","connect_failed","error"],w=function(t){function e(){var t,s;Object(c.a)(this,e);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(s=Object(l.a)(this,(t=Object(d.a)(e)).call.apply(t,[this].concat(n)))).seriesList=[{name:"sensor-data",type:"LINE",stroke:"#038C7E",strokeWidth:5,label:"Readings",labelClass:"readings"},{name:"z-score",type:"AREA",fill:"rgba(216, 13, 49, 0.2)",stroke:"transparent",strokeWidth:0,label:"Peaks",labelClass:"z-score"}],s.tsChart=new v,s.state={data:[],lastTimestamp:null,connected:!1,error:""},s.connect=function(){s.socket=f()("/?sensor=".concat(s.props.sensorId)),s.socket.on("reading",s.storeReading),y.forEach((function(t){s.socket.on(t,(function(e){return s.setError(t,e)}))}))},s.setError=function(t,e){s.setState({data:[],connected:!1,error:"".concat(e.toString()," | ").concat(t)})},s.storeReading=function(t){var e=JSON.parse(t);s.setState((function(t){var s=t.data,a=Math.max(s.length-k,0);return s.push(e),{data:s.slice(a),connected:!0,error:!1,lastTimestamp:new Date(s[s.length-1].timestamp).toLocaleTimeString()}})),s.updateChart()},s.render=function(){return i.a.createElement("div",{className:"card"},i.a.createElement("h2",null,s.state.lastTimestamp?"Sensor ".concat(s.props.sensorId):"Connecting..."),i.a.createElement("span",{className:"status "+(s.state.connected?"success":"danger")},s.state.error,i.a.createElement("i",{className:"pulse"}),s.state.connected?"Connected":"Disconnected"),i.a.createElement("div",{className:"chart-container "+(s.state.error?"faded":"")}),i.a.createElement("div",{className:"legend"},s.seriesList.map((function(t){return i.a.createElement("span",{id:t.name,key:t.name,className:t.labelClass,onClick:s.tsChart.toggleSeries},i.a.createElement("i",{className:"box"}),t.label)}))),i.a.createElement("span",{className:"timestamp "+(s.state.connected?"success":"danger")},s.state.connected?"":"Last reading was at ",s.state.lastTimestamp))},s}return Object(u.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){if(void 0===this.props.sensorId)throw new Error("You have to pass 'sensorId' prop to Chart component");if(this.props["x-ticks"]>k)throw new Error("You cannot display more than ".concat(k," 'x-ticks'. "));var t=r.a.findDOMNode(this);this.tsChart.init({elRef:t.getElementsByClassName("chart-container")[0],classList:{svg:"z-chart"}}),this.tsChart.addSeries(this.seriesList[0]),this.tsChart.addSeries(this.seriesList[1]),this.connect(),this.attachFocusWatcher()}},{key:"componentWillUnmount",value:function(){this.socket.disconnect()}},{key:"attachFocusWatcher",value:function(){window.focused=!0,window.onblur=function(){window.focused=!1},window.onfocus=function(){window.focused=!0}}},{key:"updateChart",value:function(){var t=Math.max(this.state.data.length-(this.props["x-ticks"]||20),0),e=this.state.data.slice(t),s=Math.max.apply(Math,Object(o.a)(e.map((function(t){return t.value})))),a=e.map((function(t){return{timestamp:t.timestamp,value:t.zscore?s:0}}));this.tsChart.adjustAxes(e),this.tsChart.setSeriesData("sensor-data",e,!1),this.tsChart.setSeriesData("z-score",a,!1)}}]),e}(i.a.Component);r.a.render(i.a.createElement("div",null,i.a.createElement("h1",null,"Sensors Dashboard"),i.a.createElement(w,{sensorId:"1"}),i.a.createElement(w,{sensorId:"2","x-ticks":"20"}),i.a.createElement(w,{sensorId:"3","x-ticks":"20"})),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.1f8a1349.chunk.js.map