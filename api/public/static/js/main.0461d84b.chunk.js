(this.webpackJsonplabforward=this.webpackJsonplabforward||[]).push([[0],{38:function(t,e,s){t.exports=s(74)},43:function(t,e,s){},71:function(t,e){},74:function(t,e,s){"use strict";s.r(e);var i=s(1),a=s.n(i),r=s(8),n=s.n(r),o=(s(43),s(34)),h=s(9),c=s(10),d=s(35),u=s(32),l=s(36),p=s(33),m=s.n(p),f=s(0),g=["LINE","AREA"],v=function(){function t(e){var s=e.elRef,i=e.width,a=e.height,r=e.classList;Object(h.a)(this,t),this.elRef=null,this.margin={top:10,right:30,bottom:30,left:30},this.responsiveHeight=!1,this.responsiveWidth=!1,this.xScale=f.j(),this.yScale=f.i(),this.seriesDict={},this.forceZeroOnYaxis=!0,this.elRef=s,this.outerWidth=i||this.elRef.offsetWidth,this.outerHeight=a||this.elRef.offsetHeight,this.classList=r||{},void 0===i&&(this.responsiveWidth=!0),void 0===a&&(this.responsiveHeight=!0),this.draw()}return Object(c.a)(t,[{key:"draw",value:function(){this.svg=f.k(this.elRef).append("svg").attr("width",this.outerWidth).attr("height",this.outerHeight).classed(this.classList.svg,!0),this.group=this.svg.append("g").attr("width",this.outerWidth-this.margin.left-this.margin.right).attr("height",this.outerHeight-this.margin.top-this.margin.bottom).attr("transform","translate(".concat(this.margin.left," , ").concat(this.margin.top,")")),this.xScale.range([0,this.outerWidth-this.margin.left-this.margin.right]),this.xAxisRef=this.group.append("g").attr("transform","translate(0,".concat(this.outerHeight-this.margin.bottom,")")).classed("x-axis",!0),this.yScale.range([this.outerHeight-this.margin.bottom,0]),this.yAxisRef=this.group.append("g").attr("transform","translate(0, 0)").classed("y-axis",!0)}},{key:"addSeries",value:function(t){var e=t.name,s=t.type,i=t.fill,a=t.stroke,r=t.strokeWidth,n=t.id;if(!g.includes(s))throw new Error("Series type not supported");this.seriesDict[e]={type:s,ref:this.group.append("path").attr("id",n).attr("fill",i||"none").attr("stroke",a||"black").attr("stroke-width",r||2).classed("series",!0)}}},{key:"updateSeries",value:function(t,e){var s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.seriesDict[t];switch(this.adjustDimensions(),s&&this.adjustAxes(e),i.type){case"AREA":this.updateArea(i,e);break;case"LINE":default:this.updateLine(i,e)}}},{key:"updateLine",value:function(t,e){var s=this;t.ref.datum(e).transition().duration(20).ease(f.e).attr("d",f.g().x((function(t){return s.xScale(t.timestamp)})).y((function(t){return s.yScale(t.value)})))}},{key:"updateArea",value:function(t,e){var s=this;t.ref.datum(e).transition().duration(20).ease(f.e).attr("d",f.a().x((function(t){return s.xScale(t.timestamp)})).y0(this.yScale(0)).y1((function(t){return s.yScale(t.value)})))}},{key:"adjustAxes",value:function(t){this.xScale.domain(f.f(t,(function(t){return t.timestamp}))),this.xAxisRef.transition().duration(20).ease(f.d).call(f.b(this.xScale)),this.yScale.domain([0,f.h(t,(function(t){return t.value}))]),this.yAxisRef.transition().duration(20).ease(f.d).call(f.c(this.yScale))}},{key:"adjustDimensions",value:function(){this.responsiveHeight&&(this.outerHeight=this.elRef.offsetHeight,this.svg.transition().duration(20).ease(f.d).attr("height",this.outerHeight),this.group.transition().duration(20).ease(f.d).attr("height",this.outerHeight-this.margin.top-this.margin.bottom),this.yScale.range([this.outerHeight-this.margin.bottom,0])),this.responsiveWidth&&(this.outerWidth=this.elRef.offsetWidth,this.svg.transition().duration(20).ease(f.d).attr("width",this.outerWidth),this.group.transition().duration(20).ease(f.d).attr("width",this.outerWidth-this.margin.left-this.margin.right),this.xScale.range([0,this.outerWidth-this.margin.left-this.margin.right]))}}]),t}(),y=50,k=["reconnect_error","connect_error","connect_timeout","connect_failed","error"],x=function(t){function e(){var t,s;Object(h.a)(this,e);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(s=Object(d.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(r)))).state={data:[],lastTimestamp:null,connected:!1,error:""},s.connect=function(){s.socket=m()("http://localhost:4001?sensor=".concat(s.props.sensorId)),s.socket.on("reading",s.storeReading),k.forEach((function(t){s.socket.on(t,(function(e){return s.setError(t,e)}))}))},s.setError=function(t,e){s.setState({data:[],connected:!1,error:"".concat(e.toString()," | ").concat(t)})},s.storeReading=function(t){var e=JSON.parse(t);s.setState((function(t){var s=t.data,i=Math.max(s.length-y,0);return s.push(e),{data:s.slice(i),connected:!0,error:!1,lastTimestamp:new Date(s[s.length-1].timestamp).toLocaleTimeString()}})),s.updateChart()},s.render=function(){return a.a.createElement("div",{className:"card"},a.a.createElement("span",{className:"status "+(s.state.connected?"success-bg":"danger-bg")},s.state.connected?"Connected to":"Disconnected from"," Sensor ",s.props.sensorId),a.a.createElement("span",{className:"error danger"},s.state.error),a.a.createElement("span",{className:"timestamp "+(s.state.connected?"success":"danger")},"Last poll: ",s.state.lastTimestamp),a.a.createElement("div",{className:"chart-container "+(s.state.error?"faded":"")}))},s}return Object(l.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){if(void 0===this.props.sensorId)throw new Error("You have to pass 'sensorId' prop to Chart component");if(this.props["x-ticks"]>y)throw new Error("You cannot display more than ".concat(y," 'x-ticks'. "));var t=n.a.findDOMNode(this);this.tsChart=new v({elRef:t.getElementsByClassName("chart-container")[0],classList:{svg:"z-chart"}}),this.tsChart.addSeries({name:"sensor-data",type:"LINE",id:"sensor",stroke:"steelblue"}),this.tsChart.addSeries({name:"z-score",type:"AREA",id:"zline",fill:"rgba(255, 50, 50, 0.25)",stroke:"transparent",strokeWidth:0}),this.connect()}},{key:"componentWillUnmount",value:function(){this.socket.disconnect()}},{key:"updateChart",value:function(){var t=Math.max(this.state.data.length-(this.props["x-ticks"]||20),0),e=this.state.data.slice(t),s=Math.max.apply(Math,Object(o.a)(e.map((function(t){return t.value})))),i=e.map((function(t){return{timestamp:t.timestamp,value:t.zscore?s:0}}));this.tsChart.adjustAxes(e),this.tsChart.updateSeries("sensor-data",e,!1),this.tsChart.updateSeries("z-score",i,!1)}}]),e}(a.a.Component);n.a.render(a.a.createElement("div",null,a.a.createElement(x,{sensorId:"1"}),a.a.createElement(x,{sensorId:"2","x-ticks":"15"}),a.a.createElement(x,{sensorId:"3","x-ticks":"10"})),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.0461d84b.chunk.js.map